<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Restaurante Profesional</title>

<!-- CSS propio -->
<link rel="stylesheet" href="assets/css/styles.css">

<!-- Google Material Chips -->
<link rel="stylesheet" href="https://unpkg.com/@material/chips/dist/mdc.chips.css">
<script src="https://unpkg.com/@material/chips/dist/mdc.chips.min.js" defer></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
  /* ========================= */
  /* ===== ESTILOS INDEX ===== */
  /* ========================= */
  body {
    margin: 0;
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    color: #333;
    overflow-x: hidden;
  }

  @keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  .hero {
    text-align: center;
    padding: 80px 20px 40px;
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    margin-bottom: 40px;
    animation: fadeInDown 1s ease-out;
  }
  .hero h1 {
    font-family: 'Playfair Display', serif;
    font-size: 3.5rem;
    font-weight: 800;
    color: #d84315;
    margin: 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
  }
  .hero p {
    font-size: 1.2rem;
    max-width: 700px;
    margin: 20px auto 0;
    color: #555;
    line-height: 1.6;
  }

  .carousel {
    position: relative;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto 60px;
    overflow: hidden;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  }
  .carousel-inner {
    display: flex;
    transition: transform 0.5s ease-in-out;
    height: 350px;
  }
  .carousel-item {
    min-width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    opacity: 0.8;
    transition: opacity 0.5s;
  }
  .carousel-item.active {
    opacity: 1;
  }

  .site-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 40px;
    background: rgba(255,255,255,0.97);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 2px solid #ffe0b2;
  }
  .site-header .brand {
    font-family: 'Playfair Display', serif;
    font-size: 2.2em;
    font-weight: 800;
    color: #d84315;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    transition: transform 0.3s;
  }
  .site-header .brand:hover {
    transform: scale(1.05);
  }
  .header-right { display: flex; gap: 15px; align-items: center; }
  .mesa-badge {
    font-weight: 600;
    background: linear-gradient(135deg, #ffcc80, #ffb74d);
    padding: 8px 16px;
    border-radius: 20px;
    color: #d84315;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 187, 77, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(255, 187, 77, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 187, 77, 0); }
  }

  .btn {
    cursor: pointer;
    border: none;
    padding: 12px 24px;
    border-radius: 50px;
    font-weight: 600;
    font-size: 1rem;
    letter-spacing: 0.5px;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  .btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.3);
    transition: 0.5s;
  }
  .btn:hover::before {
    left: 100%;
  }
  .btn.primary {
    background: linear-gradient(135deg, #d84315, #bf360c);
    color: white;
    transform: translateY(0);
  }
  .btn.primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(216, 67, 21, 0.6);
    background: linear-gradient(135deg, #bf360c, #8d2b0b);
  }
  .btn.small {
    padding: 8px 16px;
    font-size: 0.9em;
  }

  main.container {
    padding: 20px;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 30px;
    margin-bottom: 60px;
  }

  .menu-area {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 30px;
    width: 100%;
    max-width: 1300px;
  }

  .card { perspective: 1500px; transform-style: preserve-3d; transition: transform 0.3s ease; }
  .card:hover { transform: translateY(-10px); }
  .card-inner {
    background: white;
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    transform-style: preserve-3d;
    transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    padding: 25px;
    display: flex;
    flex-direction: column;
    height: 100%;
    position: relative;
    overflow: hidden;
  }
  .card:hover .card-inner { transform: rotateY(8deg) rotateX(5deg) scale(1.03); box-shadow:0 15px 35px rgba(0,0,0,0.25); }
  .card-inner::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s;
  }
  .card:hover .card-inner::before { opacity: 1; animation: shine 1s forwards; }

  @keyframes shine {
    0% { transform: translate(-50%, -50%) rotate(45deg) scale(0); opacity: 0; }
    50% { opacity: 0.3; }
    100% { transform: translate(-50%, -50%) rotate(45deg) scale(3); opacity: 0; }
  }

  .imgwrap { height: 180px; overflow: hidden; border-radius: 15px; margin-bottom: 20px; position: relative; }
  .imgwrap img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
  .card:hover .imgwrap img { transform: scale(1.1); }

  .title { font-weight: 700; font-size: 1.3em; margin-bottom: 10px; color: #d84315; line-height: 1.3; }
  .desc { font-size: 0.95em; margin-bottom: 20px; color: #666; line-height: 1.5; flex-grow: 1; }

  .footer { margin-top: auto; display: flex; justify-content: space-between; align-items: center; padding-top: 15px; border-top: 1px dashed #ffe0b2; }
  .qty-controls { display:flex; align-items:center; gap:8px; }
  .qty-controls .count { width:35px; text-align:center; display:inline-block; font-weight:700; font-size:1.1em; color:#d84315; }
  .qty-controls button { width:36px; height:36px; background: linear-gradient(135deg, #ffe0b2, #ffb74d); border:none; border-radius:50%; font-weight:700; font-size:1.2em; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.1); transition:all 0.3s; }
  .qty-controls button:hover { background:linear-gradient(135deg, #ffb74d, #ffa726); transform:scale(1.1); box-shadow:0 4px 8px rgba(0,0,0,0.2); }

  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:200; backdrop-filter: blur(5px); animation: fadeIn 0.5s; }
  .modal.show { display:flex; }
  .modal-content { background:white; border-radius:20px; padding:30px; width:90%; max-width:550px; box-shadow:0 20px 40px rgba(0,0,0,0.3); transform:scale(0.9); opacity:0; animation: modalPop 0.5s forwards; }
  @keyframes modalPop { to { transform:scale(1); opacity:1; } }
  .cart-footer { margin-top:20px; display:flex; flex-direction:column; gap:15px; }
  input#note { width:100%; padding:12px; border-radius:12px; border:2px solid #ffe0b2; font-size:1rem; transition:border-color 0.3s; }
  input#note:focus { outline:none; border-color:#ffb74d; box-shadow:0 0 0 3px rgba(255,183,77,0.3); }
  .total { font-weight:800; font-size:1.4em; text-align:right; color:#d84315; }

  @keyframes fadeInDown { from { opacity:0; transform:translateY(-30px); } to { opacity:1; transform:translateY(0); } }
  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

  @media(max-width:768px){.hero h1{font-size:2.5rem;}.site-header{padding:15px 20px;}.site-header .brand{font-size:1.8em;}.menu-area{grid-template-columns:1fr;}.carousel{height:250px;}}

  /* ================================ */
  /* ===== ESTILOS SECCION COCINA ==== */
  /* ================================ */
  #cookSection { display:none; padding:20px; }
  .cook-header { margin-bottom:20px; display:flex; justify-content:space-between; align-items:center; }
  .orders-list div { margin-bottom:10px; }
</style>
</head>

<body>
<!-- ======= HERO ======= -->
<section class="hero">
  <h1>¡Bienvenidos al Restaurante Profesional!</h1>
  <p>Disfruta de una experiencia culinaria única con nuestros platillos gourmet, preparados con ingredientes frescos y recetas exclusivas. ¡Tu mesa te espera!</p>
</section>

<!-- ======= CAROUSEL ======= -->
<div class="carousel">
  <div class="carousel-inner" id="carouselInner"></div>
</div>

<!-- ======= HEADER ======= -->
<header class="site-header">
  <div class="brand">Restaurante Profesional</div>
  <div class="header-right">
    <div id="mesaBadge" class="mesa-badge">Mesa: --</div>
    <button id="openCartBtn" class="btn small">Ver Pedido <span id="cartCount">0</span></button>
  </div>
</header>

<!-- ======= MAIN MENU ======= -->
<main class="container">
  <section id="menuArea" class="menu-area"></section>
</main>

<!-- ======= MODAL CARRITO ======= -->
<div id="cartModal" class="modal">
  <div class="modal-content">
    <h3>Tu Pedido</h3>
    <div id="cartItems"></div>
    <div class="cart-footer">
      <input id="note" placeholder="Observaciones (p.ej. sin cebolla)">
      <div class="total">Total: $<span id="cartTotal">0.00</span></div>
      <button id="placeOrderBtn" class="btn primary">Hacer pedido</button>
      <button id="closeCartBtn" class="btn">Cerrar</button>
      <button id="openCookBtn" class="btn" style="background:#d84315; color:white;">Ir a Cocina</button>
    </div>
  </div>
</div>

<!-- ======= SECCIÓN COCINA ======= -->
<section id="cookSection">
  <header class="site-header cook-header">
    <div class="brand">Panel Cocinero</div>
    <div style="display:flex; gap:10px; align-items:center;">
      <input id="tokenInput" placeholder="Token del cocinero" style="padding:8px; border-radius:10px; border:1px solid #ccc;" />
      <button id="unlockBtn" class="btn small primary">Abrir</button>
      <button id="muteBtn" class="btn small">Silenciar</button>
      <button id="backToMenuBtn" class="btn small" style="background:#d84315; color:white;">Volver al Menú</button>
    </div>
  </header>
  <main class="container cook-container">
    <div id="ordersList" class="orders-list" style="background:#fff9f5; padding:20px; border-radius:15px; min-height:200px;">
      Introduce token y presiona Abrir...
    </div>
  </main>
</section>

<!-- ======= SCRIPT ======= -->
<script>
const API_BASE = 'https://script.google.com/macros/s/AKfycbwRjyKTpEIAA78HGhZcFXx5oVrhQQZtd39fj1FRE5c-0s80zDt0ABZpDUMNetUtMq9J/exec';
let CART = { items: [], mesa: null };

const carouselImages = [
  'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?auto=format&fit=crop&w=800&q=80',
  'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=800&q=80',
  'https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=800&q=80'
];

const carouselInner = document.getElementById('carouselInner');
carouselImages.forEach((src, i) => {
  const div = document.createElement('div');
  div.classList.add('carousel-item');
  if(i===0) div.classList.add('active');
  div.style.backgroundImage = `url(${src})`;
  carouselInner.appendChild(div);
});

let currentSlide = 0;
setInterval(() => {
  const items = document.querySelectorAll('.carousel-item');
  items[currentSlide].classList.remove('active');
  currentSlide = (currentSlide+1)%items.length;
  items[currentSlide].classList.add('active');
},4000);

function showCart(){document.getElementById('cartModal').classList.add('show');}
function closeCart(){document.getElementById('cartModal').classList.remove('show');}
document.getElementById('openCartBtn').addEventListener('click',showCart);
document.getElementById('closeCartBtn').addEventListener('click',closeCart);

const menuData = [
  {id:'m001',name:'Lomo Saltado',description:'Lomo de res con papas',price:12.5,img:'https://images.unsplash.com/photo-1604908177520-ff00a1de0f71?auto=format&fit=crop&w=400&q=80'},
  {id:'m002',name:'Ceviche',description:'Ceviche de camarón fresco',price:10.0,img:'https://images.unsplash.com/photo-1603052875387-129d3eae7d0e?auto=format&fit=crop&w=400&q=80'},
  {id:'m003',name:'Tortillas',description:'Tortilla de maíz casera',price:1.0,img:'https://images.unsplash.com/photo-1572441711446-71e4f270f7d8?auto=format&fit=crop&w=400&q=80'}
];

const menuArea = document.getElementById('menuArea');
menuData.forEach(item=>{
  const card=document.createElement('div');card.className='card';
  card.innerHTML=`<div class="card-inner">
  <div class="imgwrap"><img src="${item.img}"/></div>
  <div class="title">${item.name}</div>
  <div class="desc">${item.description}</div>
  <div class="footer">
    <div class="qty-controls">
      <button class="minus">-</button>
      <div class="count">1</div>
      <button class="plus">+</button>
    </div>
    <button class="btn primary add">Agregar</button>
  </div>
  </div>`;
  menuArea.appendChild(card);

  const minus = card.querySelector('.minus');
  const plus = card.querySelector('.plus');
  const count = card.querySelector('.count');
  let qty=1;
  minus.addEventListener('click',()=>{if(qty>1){qty--;count.textContent=qty;}});
  plus.addEventListener('click',()=>{qty++;count.textContent=qty;});
  card.querySelector('.add').addEventListener('click',()=>{CART.items.push({...item,qty});updateCart();});
});

function updateCart(){
  const cartItems=document.getElementById('cartItems');
  cartItems.innerHTML='';
  let total=0;
  CART.items.forEach(i=>{
    const div=document.createElement('div');
    div.textContent=`${i.name} x ${i.qty} - $${(i.price*i.qty).toFixed(2)}`;
    cartItems.appendChild(div);
    total+=i.price*i.qty;
  });
  document.getElementById('cartTotal').textContent=total.toFixed(2);
  document.getElementById('cartCount').textContent=CART.items.length;
}

// ======= COCINA =======
const cookArea=document.getElementById('cookSection');
function showCookView(){menuArea.style.display='none';document.getElementById('cartModal').style.display='none';cookArea.style.display='block';}
function showMenuView(){menuArea.style.display='flex';cookArea.style.display='none';}

document.getElementById('backToMenuBtn').addEventListener('click',showMenuView);

const COOK_TOKEN='cocina';
document.getElementById('unlockBtn').addEventListener('click',async()=>{
  const token=document.getElementById('tokenInput').value.trim();
  if(token!==COOK_TOKEN){alert('Token incorrecto');return;}
  showCookView();
  await fetchOrders();
});

async function fetchOrders(){
  const ordersList=document.getElementById('ordersList');
  ordersList.innerHTML='Cargando pedidos...';
  try{
    const res=await fetch(`${API_BASE}?fn=getOrders`);
    const data=await res.json();
    if(data && data.orders && data.orders.length>0){renderOrders(data.orders);}
    else{ordersList.innerHTML='No hay pedidos pendientes.';}
  }catch(err){console.error(err);ordersList.innerHTML='Error al cargar pedidos';}
}

function renderOrders(orders){
  const ordersList=document.getElementById('ordersList');
  ordersList.innerHTML='';
  orders.forEach(o=>{
    const div=document.createElement('div');
    div.style.background='#fff3e0';
    div.style.marginBottom='15px';
    div.style.padding='15px';
    div.style.borderRadius='12px';
    div.innerHTML=`<div><b>ID:</b> ${o.order_id}</div>
      <div><b>Mesa:</b> ${o.mesa_id}</div>
      <div><b>Fecha:</b> ${new Date(o.timestamp).toLocaleString()}</div>
      <div><b>Items:</b> ${o.items_json.map(i=>`${i.name} x ${i.qty}`).join(', ')}</div>
      <div><b>Total:</b> $${o.total.toFixed(2)}</div>
      <div><b>Nota:</b> ${o.note||'-'}</div>
      <div><b>Status:</b> ${o.status}</div>`;
    ordersList.appendChild(div);
  });
}

document.getElementById('muteBtn').addEventListener('click',()=>{alert('Silenciado (aquí puedes agregar notificaciones sonoras)');});

document.getElementById('openCookBtn').addEventListener('click',()=>{
  document.getElementById('cartModal').style.display='none';
  cookArea.style.display='block';
});
</script>

</body>
</html>
