<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Cocinero - Pedidos Pendientes</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
header { background:#333; color:white; padding:10px; display:flex; justify-content:space-between; align-items:center; }
header input { padding:5px; margin-right:5px; }
header button { padding:5px 10px; background:#4CAF50; color:white; border:none; border-radius:3px; cursor:pointer; }
#ordersList { padding:20px; }
.order-card { background:white; padding:15px; margin-bottom:10px; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.order-card button { background:#2196F3; color:white; border:none; padding:5px 10px; margin-top:10px; cursor:pointer; border-radius:3px; }
</style>
</head>
<body>

<header>
  <div>Panel Cocinero</div>
  <div>
    <input id="tokenInput" placeholder="Token">
    <button id="unlockBtn">Abrir</button>
  </div>
</header>

<div id="ordersList">Introduce token y presiona Abrir...</div>

<script>
const API_BASE = 'https://script.google.com/macros/s/AKfycbwRjyKTpEIAA78HGhZcFXx5oVrhQQZtd39fj1FRE5c-0s80zDt0ABZpDUMNetUtMq9J/exec'; // Reemplaza con tu URL publicada del Apps Script
const COOK_TOKEN = 'cocina';
let intervalID;

// Desbloquear panel con token
document.getElementById('unlockBtn').addEventListener('click', () => {
    const token = document.getElementById('tokenInput').value.trim();
    if(token !== COOK_TOKEN){ alert('Token incorrecto'); return; }
    loadOrders();
    if(intervalID) clearInterval(intervalID);
    intervalID = setInterval(loadOrders, 5000);
});

// Cargar pedidos pendientes
async function loadOrders(){
    try{
        const res = await fetch(`${API_BASE}?fn=getOrders`);
        const data = await res.json();
        const container = document.getElementById('ordersList');
        container.innerHTML = '';

        if(!data.orders || data.orders.length === 0){
            container.innerHTML = 'No hay pedidos pendientes';
            return;
        }

        data.orders.forEach(order => {
            const div = document.createElement('div');
            div.className = 'order-card';
            div.innerHTML = `<strong>Mesa ${order.mesa_id}</strong><br>
                             ${order.items.map(i => `${i.name} x${i.qty}`).join(', ')}<br>
                             Nota: ${order.note||''}<br>
                             <button data-id="${order.order_id}">Terminar</button>`;
            div.querySelector('button').addEventListener('click', () => markDone(order.order_id));
            container.appendChild(div);
        });

    } catch(err){
        console.error(err);
        document.getElementById('ordersList').innerText = 'Error al cargar pedidos';
    }
}

// Marcar como TERMINADO
async function markDone(order_id){
    try{
        const res = await fetch(API_BASE, {
            method:'POST',
            headers:{ 'Content-Type':'text/plain' },
            body: JSON.stringify({ fn:'updateOrderStatus', order_id:order_id })
        });
        const data = await res.json();
        if(data.success) loadOrders();
        else alert('Error al actualizar pedido');
    } catch(err){
        console.error(err);
        alert('Error de conexi√≥n');
    }
}
</script>

</body>
</html>
