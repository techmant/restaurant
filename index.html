<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Panel Cocinero</title>
<style>
body{font-family:sans-serif;padding:20px;}
#ordersList div{padding:10px;border:1px solid #ccc;margin:8px 0;border-radius:5px;}
.btn{padding:5px 10px;margin-left:10px;cursor:pointer;background:#4CAF50;color:white;border:none;border-radius:3px;}
</style>
</head>
<body>

<h1>Panel Cocinero</h1>
<div>
  <input id="tokenInput" placeholder="Token del cocinero">
  <button id="unlockBtn" class="btn">Abrir</button>
</div>

<div id="ordersList">Introduce token y presiona Abrir...</div>

<script>
const API_BASE = 'https://script.google.com/macros/s/AKfycbwRjyKTpEIAA78HGhZcFXx5oVrhQQZtd39fj1FRE5c-0s80zDt0ABZpDUMNetUtMq9J/exec'; // Reemplaza con la URL publicada del Apps Script
const COOK_TOKEN = 'cocina';
let intervalID;

document.getElementById('unlockBtn').addEventListener('click', ()=>{
  const token = document.getElementById('tokenInput').value.trim();
  if(token !== COOK_TOKEN) return alert('Token incorrecto');
  loadOrders();
  if(intervalID) clearInterval(intervalID);
  intervalID = setInterval(loadOrders,5000);
});

async function loadOrders(){
  try{
    const res = await fetch(`${API_BASE}?fn=getOrders`);
    const data = await res.json();
    const container = document.getElementById('ordersList');
    container.innerHTML = '';
    if(data.orders && data.orders.length){
      data.orders.forEach(o=>{
        const div = document.createElement('div');
        const items = (o.items||[]).map(i=>`${i.name} x${i.qty}`).join(', ');
        div.innerHTML = `<strong>Mesa ${o.mesa_id}</strong>: ${items}<br>Nota: ${o.note||''} <button class="btn" onclick="finishOrder('${o.order_id}')">Terminar</button>`;
        container.appendChild(div);
      });
    } else container.innerHTML = 'No hay pedidos pendientes';
  }catch(err){
    console.error(err);
    document.getElementById('ordersList').innerHTML = 'Error al cargar pedidos';
  }
}

async function finishOrder(order_id){
  try{
    const res = await fetch(`${API_BASE}?fn=updateOrderStatus&order_id=${order_id}`);
    const data = await res.json();
    if(data.success) loadOrders();
    else alert('Error al terminar pedido');
  }catch(err){console.error(err);}
}
</script>

</body>
</html>
